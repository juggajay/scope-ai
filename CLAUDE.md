The Identity: "You are an expert CTO and Senior Engineer."

## Rules

Rule #1: Understand Before Acting
AI must read the codebase and relevant files before proposing changes.
Never speculate about code it hasn't opened.

Rule #2: Check In Before Major Changes
Propose an approach and wait for user approval before making significant modifications.

Rule #3: Communicate Clearly
Provide a high-level explanation of what changes were made at every step.
Keep explanations concise but informative.

Rule #4: Simplicity Above All
Make every task and code change as simple as possible.
Avoid massive or complex changes; choose the simpler solution when in doubt.

Rule #5: Maintain Documentation
Keep the architecture (ARCHITECTURE.md), PRD (PRD.md), and build plan updated so the agent doesn't lose context.

---

## Project: ScopeAI

AI-powered renovation scope generator for Australian homeowners. Users upload photos, answer guided questions, and receive professional trade-specific scope-of-works documents they send to tradies for comparable quotes.

**Full PRD:** `PRD.md`
**System Design:** `ARCHITECTURE.md` (read this FIRST — it has the complete data flow, schema, and all technical decisions)

---

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Frontend | Next.js 14+ (App Router) |
| Styling | Tailwind CSS v4 + shadcn/ui |
| Backend | Convex (database, server functions, file storage, auth) |
| AI | Google Gemini 3 API (vision + text) |
| Payments | Stripe (Checkout Sessions + webhooks) |
| PDF | @react-pdf/renderer |
| Email | Resend |
| Hosting | Vercel |
| Font | Geist (via next/font) |
| Icons | Lucide React |
| Analytics | PostHog (funnel tracking, feature flags) |

---

## Design System

- **Colours:** Teal (`#14B8A6`) as primary accent, black/white for backgrounds and text
- **Dark mode:** Full support via CSS variables — teal stays constant, black ↔ white invert
- **Font:** Geist Sans (400, 500, 600, 700)
- **Components:** shadcn/ui with teal primary colour override
- **Border radius:** `rounded-lg` (8px) cards, `rounded-md` (6px) inputs/buttons
- **Shadows:** Minimal — `shadow-sm` only for elevated cards
- **Full colour system and CSS variables:** See `ARCHITECTURE.md` Section 10
- **UX research:** See `research-output/ux-wizard/` for wizard patterns, animations, and component specs (when available)

---

## Design Standards — READ THIS

**This app must look like it was designed by a senior product designer, not generated by AI.**

### What we mean by "professional"
- Think **Linear**, **Vercel**, **Stripe Dashboard** — restrained, confident, intentional
- Every pixel has a reason. No filler. No decoration for decoration's sake
- Generous whitespace. Let content breathe. Don't cram elements together
- Typography hierarchy does the heavy lifting — not colours, borders, or icons
- Subtle motion that adds meaning (Framer Motion), never gratuitous animation

### What we do NOT want (AI slop indicators)
- Generic hero sections with gradient blobs and "Revolutionize your X" copy
- Excessive emoji usage in UI (they're fine for trade icons in scope output, nowhere else)
- Rainbow gradients, glassmorphism, excessive shadows, glowing borders
- Cookie-cutter SaaS landing page templates (alternating left-right feature sections with stock illustrations)
- Components that look like shadcn/ui defaults without any customisation
- Overly rounded corners (max `rounded-lg`), pill-shaped everything
- "Dashboard-itis" — making every page look like a dashboard with cards everywhere
- Placeholder-quality copy ("Lorem ipsum", "Your amazing feature here")

### Design rules
1. **Restrained colour use.** Teal appears on primary CTAs, active states, and key accents — NOT on every element. Most of the page is black/white/grey with teal as the punctuation
2. **One visual hierarchy per section.** Each section has ONE thing your eye goes to first. If everything is bold, nothing is
3. **Whitespace is a feature.** Sections need `py-16` to `py-24` breathing room. Cards need `p-6` minimum. Don't fear empty space
4. **Copy must be specific.** "Get comparable renovation quotes in under 10 minutes" not "Transform your renovation experience". Speak to the Australian homeowner, not a generic SaaS buyer
5. **Mobile-first means mobile-first.** Design the 375px view first. Desktop is the enhancement, not the other way around
6. **Interactions must feel physical.** Buttons depress slightly on press. Cards lift subtly on hover. Selections snap with intent. Use `transition-all duration-150` minimum
7. **No default shadcn/ui.** Every shadcn component must be styled to match the design system. Default grey buttons are banned. Customise colours, sizing, and spacing to feel intentional
8. **Test in dark mode constantly.** Every component must look equally good in both modes. Dark mode is not an afterthought

---

## Technology & Integration Guide

**Before implementing any library, look up its latest documentation using Context7** (`resolve-library-id` → `query-docs`). Do not rely on memorised patterns — APIs change.

### Frontend Components — shadcn/ui
- **Always use shadcn/ui components** as the base. Do NOT build custom buttons, inputs, cards, dialogs, tabs, etc. from scratch
- Install via CLI: `npx shadcn@latest add [component]`
- After installing, **customise every component** to match the design system. Default styling is not acceptable
- Key components to use: `Button`, `Card`, `Input`, `Label`, `Select`, `Checkbox`, `Tabs`, `Dialog`, `Progress`, `Badge`, `Separator`, `Tooltip`, `Accordion`, `Sheet` (mobile nav)
- Look up latest shadcn/ui docs via Context7 before using

### Animation — Framer Motion
- **Use Framer Motion for all meaningful animation.** Wizard step transitions, card selections, progress indicators, page entrances
- Install: `npm install framer-motion`
- Key patterns: `AnimatePresence` for step transitions, `motion.div` with `whileTap`/`whileHover` for interactive elements, `layout` prop for smooth reflows
- **Respect `prefers-reduced-motion`** — provide fallback with instant transitions
- Look up latest Framer Motion docs via Context7 before implementing transitions
- See `research-output/ux-wizard/` for specific animation specs (when available)

### Dark Mode — next-themes
- **Use next-themes. Do NOT build custom dark mode.**
- Install: `npm install next-themes`
- Wrap app in `ThemeProvider` with `attribute="class"` and `defaultTheme="system"`
- All colour switching happens via CSS variables in `globals.css` — no component-level theme logic
- Look up latest next-themes docs via Context7

### Backend — Convex
- **All backend logic runs in Convex** — queries, mutations, actions. No Next.js API routes
- Install: `npm install convex`
- Schema defined in `convex/schema.ts` (see ARCHITECTURE.md Section 3)
- Use `useQuery()` and `useMutation()` hooks in React components for reactive data
- Use `action()` for async work that calls external APIs (Gemini, Stripe, Resend)
- Look up latest Convex docs via Context7 — especially for auth, file storage, and HTTP endpoints

### Auth — Convex Auth
- **Use Convex Auth. Do NOT use NextAuth, Auth.js, or custom auth.**
- Supports email/password + Google OAuth
- Look up latest Convex Auth docs via Context7 for setup patterns

### Payments — Stripe Checkout
- **Use Stripe Checkout (hosted page). Do NOT build custom payment forms.**
- Create Checkout Session server-side (Convex action), redirect client to Stripe
- Handle payment confirmation via webhook (Convex HTTP endpoint)
- Install: `npm install stripe` (server-side only)
- Look up latest Stripe Checkout docs via Context7

### AI — Google Gemini 3
- **Use the `@google/generative-ai` SDK**
- Install: `npm install @google/generative-ai`
- Vision API for photo analysis (multimodal), text API for scope generation
- All AI calls happen in Convex actions (server-side, never client-side)
- Look up latest Gemini API docs via Context7

### PDF — @react-pdf/renderer
- **Use @react-pdf/renderer for PDF generation. Do NOT use html-to-pdf or puppeteer.**
- Install: `npm install @react-pdf/renderer`
- PDF templates are React components
- Look up latest @react-pdf/renderer docs via Context7

### Email — Resend
- **Use Resend for transactional email.**
- Install: `npm install resend`
- Called from Convex action (server-side)
- Look up latest Resend docs via Context7

### Icons — Lucide React
- **Use Lucide React for ALL icons. Do NOT mix icon libraries.**
- Already included with shadcn/ui
- Import: `import { IconName } from "lucide-react"`

### Font — Geist
- Load via `next/font/google` or the `geist` package
- Apply to `<body>` in root layout
- Weights: 400 (body), 500 (labels), 600 (headings), 700 (hero)

---

## What Already Exists

These files are code-ready and should be used during build:

```
types/index.ts                    — All TypeScript types (the contract between AI, DB, and UI)
lib/trades.ts                     — Trade determination logic (project type + answers → required trades)
lib/constants.ts                  — Pricing tiers, project types, states, upload limits
lib/questions/index.ts            — Question set loader
lib/questions/kitchen.ts          — Kitchen question set (12 questions)
lib/questions/bathroom.ts         — Bathroom question set (13 questions)
lib/questions/laundry.ts          — Laundry question set (7 questions)
lib/questions/living.ts           — Living area question set (8 questions)
lib/questions/outdoor.ts          — Outdoor question set (9 questions)
lib/ai/validation.ts              — Post-generation validation rules
lib/ai/prompts/master-system.md   — Master AI system prompt (shared across trades)
lib/ai/prompts/photo-analysis.md  — Photo analysis prompt for Gemini Vision
lib/sequencing/templates.ts       — Sequencing templates for all 5 project types
```

**Do NOT rewrite these files.** They were carefully designed and reviewed. Use them as-is during integration.

---

## Build Plan

See **`BUILD.md`** for the complete phased implementation plan with tasks, dependencies, and acceptance criteria.

**Do NOT build these yet** (later phases):
- Stripe integration — Build after scope view works (Phase 8)
- PDF generation — Build after Stripe works (Phase 9)
- Email delivery — Build after PDF works (Phase 9)

---

## Key Decisions (Do Not Change)

These were discussed and agreed. Don't revisit unless explicitly asked:

| Decision | Choice |
|----------|--------|
| Auth timing | Required before generation (after photos + questions, before hitting Generate) |
| Photo analysis timing | Starts immediately on upload, runs in background during questions |
| Scope storage | Generate once, store as JSON in Convex |
| Paywall content | Summary only — trade names, item counts, 1-2 sample items. No full scopes free |
| Progress UX | Hybrid — real backend milestones + smooth client animation between them |
| Error recovery | Save each trade as it completes, auto-retry once, manual retry for persistent failures |
| Scope editing | Item toggles (include/exclude) persist and affect PDF output |
| MVP project scope | Single room only (kitchen, bathroom, laundry, living, outdoor) |
| Sequencing approach | Hybrid — template structure + AI fills project-specific details |
| Questions | Static per project type in MVP, no photo-based adaptation |

---

## File Structure Reference

See `ARCHITECTURE.md` Section 11 for the complete planned file tree.

---

## Research Status

Research output is in `research-output/`. Reference these during build:

### UX Research
- **Wizard UX: COMPLETE** (8 files in `research-output/ux-wizard/`)
  - **`RESEARCH-wizard-implementation-spec.md` — READ THIS FIRST for ALL wizard work.** Contains exact animation configs, component specs, Tailwind classes, Framer Motion variants, card states, progress weights, and per-step UX specs. This is the wizard blueprint.
  - Supporting files: examples, progress, animations, cards, photo-upload, question-flow, state

### Trade Research
- Electrical: COMPLETE (5 files in `research-output/electrical/`)
- Carpentry: COMPLETE (9 files in `research-output/carpentry/`)
- Structural: COMPLETE (8 files in `research-output/structural/`)
- Plumbing: COMPLETE (9 files in `research-output/plumbing/`)
- Stone/Benchtop: COMPLETE (6 files in `research-output/stone-benchtop/`)
- Demolition: COMPLETE (6 files in `research-output/demolition/`)
- Tiling: COMPLETE (8 files in `research-output/tiling/`)
- Painting: COMPLETE (6 files in `research-output/painting/`)
- Waterproofing: COMPLETE (6 files in `research-output/waterproofing/`)

Research prompts (what was sent to the researcher) are in `research-prompts/` for reference.

All 9 trade prompts are written and deployed in `convex/lib/prompts.ts`.
